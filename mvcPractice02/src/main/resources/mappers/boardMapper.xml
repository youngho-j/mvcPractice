<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.spring.board.boardMapper">
 
    <select id="getBoardList" parameterType="com.spring.board.form.BoardForm" resultType="com.spring.board.dto.BoardDto">
    
         SELECT *
         FROM (
         		SELECT BOARD_SEQ 
             		 , BOARD_RE_REF 
             		 , BOARD_RE_LEV 
           	 		 , BOARD_RE_SEQ 
             		 , BOARD_WRITER 
             		 , BOARD_SUBJECT 
             		 , BOARD_CONTENT 
             		 , BOARD_HITS
             		 , DEL_YN 
		             , INS_USER_ID
		             , CAST( DATE_FORMAT( INS_DATE, '%Y-%m-%d %H:%i:%s' ) AS CHAR(19) ) AS INS_DATE
		             , UPD_USER_ID
		             , CAST( DATE_FORMAT( UPD_DATE, '%Y-%m-%d %H:%i:%s' ) AS CHAR(19) ) AS UPD_DATE  
        		FROM board.MyBOARD
        		ORDER BY BOARD_RE_REF DESC, BOARD_RE_SEQ ASC
    		 ) T1
    	LIMIT #{limit} OFFSET #{offset}
    </select>
    
     <select id="getBoardDetail" parameterType="com.spring.board.form.BoardForm" resultType="com.spring.board.dto.BoardDto">
    
        SELECT BOARD_SEQ 
             , BOARD_RE_REF 
             , BOARD_RE_LEV 
             , BOARD_RE_SEQ 
             , BOARD_WRITER 
             , BOARD_SUBJECT 
             , BOARD_CONTENT 
             , BOARD_HITS
             , DEL_YN 
             , INS_USER_ID
             , CAST( DATE_FORMAT( INS_DATE, '%Y-%m-%d %H:%i:%s' ) AS CHAR(19) ) AS INS_DATE
             , UPD_USER_ID
             , CAST( DATE_FORMAT( UPD_DATE, '%Y-%m-%d %H:%i:%s' ) AS CHAR(19) ) AS UPD_DATE  
        FROM board.MyBOARD
        WHERE BOARD_SEQ = #{board_seq}
    
    </select>
    
    <update id="updateBoardHits" parameterType="com.spring.board.form.BoardForm">
    	UPDATE board.MyBOARD
    	SET BOARD_HITS = BOARD_HITS + 1
    			, UPD_USER_ID = 'NONMEMBER'
            	, UPD_DATE = NOW()
        WHERE BOARD_SEQ = #{board_seq}
    </update>
    
    <insert id="insertBoard" parameterType="com.spring.board.form.BoardForm">
    	INSERT INTO board.MyBOARD
    		(
    			BOARD_RE_REF
    			, BOARD_RE_LEV
                , BOARD_RE_SEQ
                , BOARD_WRITER
                , BOARD_SUBJECT
                , BOARD_CONTENT
                , INS_USER_ID
                , INS_DATE
                , UPD_USER_ID
                , UPD_DATE
    		)
    	VALUES
    		(
    			0
                , 0
                , 0
                , #{board_writer}
                , #{board_subject}
                , #{board_content}
                , 'NONMEMBER'
                , NOW() 
                , 'NONMEMBER'
                , NOW() 	
    		)
    </insert>
    
    <update id="updateBoard" parameterType="com.spring.board.form.BoardForm">
    	UPDATE board.MyBOARD
    	SET BOARD_SUBJECT = #{board_subject}
    		, BOARD_CONTENT = #{board_content}
    		, UPD_USER_ID = 'NOMEMBER'
    		, UPD_DATE = NOW()
    	WHERE BOARD_SEQ = #{board_seq}
    </update>
    
    <delete id="deleteBoard" parameterType="com.spring.board.form.BoardForm">
    	DELETE
    	FROM board.MyBOARD
    	WHERE BOARD_SEQ = #{board_seq}
    </delete>
    
    <select id="getBoardCnt" parameterType="com.spring.board.form.BoardForm" resultType="int">
		SELECT COUNT(*)
		FROM board.MyBOARD    	
    </select>
    
</mapper>
